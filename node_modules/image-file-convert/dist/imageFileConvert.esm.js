var defineProperty=function(a,b,c){b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):(a[b]=c);return a},_CODE,CODE=(_CODE={}, defineProperty(_CODE,'NOT_IMAGE',-1), defineProperty(_CODE,'CANVAS_TO_IMAGE_ERROR',-2), defineProperty(_CODE,'GET_IMAGE_FILE_ERROR',-3), _CODE);typeof Object.assign!=='function'&&Object.defineProperty(Object,"assign",{value:function c(a,b){if(a==null){throw new TypeError('Cannot convert undefined or null to object')}var d=Object(a);for(var e=1;e<arguments.length;e++){var f=arguments[e];if(f!=null){for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(d[g]=f[g])}}return d},writable:!0,configurable:!0});var ImageFileConvert={getOrientation:function c(a,b){var d=new FileReader();d.onload=function(a){var c=new DataView(a.target.result);if(c.getUint16(0,!1)!=0xFFD8)return b(-2);var d=c.byteLength,e=2;while(e<d){var f=c.getUint16(e,!1);e+=2;if(f==0xFFE1){if(c.getUint32(e+=2,!1)!=0x45786966){return b(-1)}var g=c.getUint16(e+=6,!1)==0x4949;e+=c.getUint32(e+4,g);var h=c.getUint16(e,g);e+=2;for(var i=0;i<h;i++){if(c.getUint16(e+i*12,g)==0x0112)return b(c.getUint16(e+i*12+8,g))}}else if((f&0xFF00)!=0xFF00)break;else e+=c.getUint16(e,!1)}return b(-1)};d.readAsArrayBuffer(a.slice(0,65536))},base64UrlToBlob:function b(a){var c=window.atob(a.split(',')[1]),d=new ArrayBuffer(c.length),e=new Uint8Array(d);for(var f=0;f<c.length;f++)e[f]=c.charCodeAt(f);return new Blob([d],{type:'image/png'})},dataURLtoFile:function b(a){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'file',d=a.split(','),e=d[0].match(/:(.*?);/)[1],f=e.split('/')[1],g=atob(d[1]),h=g.length,i=new Uint8Array(h);while(h--)i[h]=g.charCodeAt(h);return new File([i],c+'.'+f,{type:e})},dataURLtoBlob:function b(a){var c=window.Blob&&function(){try{return Boolean(new Blob())}catch(a){return !1}}(),d=c&&window.Uint8Array&&function(){try{return new Blob([new Uint8Array(100)]).size===100}catch(a){return !1}}(),f=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,g=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0;h=a.match(g);if(!h){throw new Error('invalid data URI')}i=h[2]?h[1]:'text/plain'+(h[3]||';charset=US-ASCII');j=!!h[4];k=a.slice(h[0].length);j?(l=atob(k)):(l=decodeURIComponent(k));m=new ArrayBuffer(l.length);n=new Uint8Array(m);for(o=0;o<l.length;o+=1)n[o]=l.charCodeAt(o);if(c){return new Blob([d?n:m],{type:i})}p=new f();p.append(m);return p.getBlob(i)},blobToImage:function b(a){var c=new Image();c.src=URL.createObjectURL(a);return c},getImageFileData:function b(a){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},d=this,e=null;function f(b,c,f){e=d.blobToImage(b);var g=Object.assign(b,{name:a.name,lastModified:a.lastModified,lastModifiedDate:a.lastModifiedDate,webkitRelativePath:a.webkitRelativePath});e.onload=function(){var a=d.imageToBase64(e);c({blob:g,base64:a})};e.onerror=function(){c({blob:g,base64:null})}}return new Promise(function(b,e){d.getOrientation(a,function(g){d.fileToCanvas(a,c).then(function(a){var c=a.canvas,h=a.image;g===6&&ImageFileConvert.rotate(c,h,90);if(c.toBlob)c.toBlob(function(a){f(a,b,e)});else{var i=c.toDataURL('image/png'),j=d.dataURLtoBlob(i);f(j,b,e)}},function(a){e({code:CODE.GET_IMAGE_FILE_ERROR,msg:'获取图片资源失败'})})})})},imageToCanvas:function b(a){var c=document.createElement('canvas'),d=c.getContext('2d');c.width=a.width;c.height=a.height;d.drawImage(a,0,0);return c},canvasToBase64:function b(a){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'image/png',d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'0.92';return a.toDataURL(c,d)},canvasToFile:function b(a){var c=this.canvasToBase64(a);return this.dataURLtoFile(c)},imageToBase64:function b(a){var c=this.imageToCanvas(a);return c.toDataURL('image/png')},fileToImage:function b(a){return new Promise(function(b,c){var d=new FileReader();d.readAsDataURL(a);d.onload=function(a){var d=a.target.result,e=new Image();e.onload=function(){b(e)};e.onerror=function(){c({code:CODE.NOT_IMAGE,msg:'文件不是图片'})};e.src=d}})},canvasToImage:function b(a){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'image/png',d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},e=a.toDataURL(c,d),f=document.createElement('img');return new Promise(function(a,b){f.onload=function(){a(f)};f.onerror=function(){b({code:CODE.CANVAS_TO_IMAGE_ERROR})};f.src=e})},fileToCanvas:function b(a){var c=this,d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},e=this,f=document.createElement('canvas'),g=f.getContext('2d');return new Promise(function(b,h){e.fileToImage(a).then(function(a){var h=a.naturalWidth,i=a.naturalHeight;if(d.width){var j=d.width,k=d.height;f.width=j;k?(f.height=k):(f.height=j*i/h)}else f.width=h,f.height=i;d.cover?(e.drawImageWithCover(g,a,0,0,f.width,f.height),c.canvasToImage(f).then(function(a){b({canvas:f,image:a})})):(e.drawImageWithContain(f,a),c.canvasToImage(f).then(function(a){b({canvas:f,image:a})}))})})},drawImageWithCover:function i(a,b,c,d,e,f,g,h){arguments.length===2&&(c=d=0,e=a.canvas.width,f=a.canvas.height);g=typeof g==="number"?g:0.5;h=typeof h==="number"?h:0.5;g<0&&(g=0);h<0&&(h=0);g>1&&(g=1);h>1&&(h=1);var j=b.width,k=b.height,l=Math.min(e/j,f/k),m=j*l,n=k*l,o,p,q,r,s=1;m<e&&(s=e/m);Math.abs(s-1)<1e-14&&n<f&&(s=f/n);m*=s;n*=s;q=j/(m/e);r=k/(n/f);o=(j-q)*g;p=(k-r)*h;o<0&&(o=0);p<0&&(p=0);q>j&&(q=j);r>k&&(r=k);a.drawImage(b,o,p,q,r,c,d,e,f)},drawImageWithContain:function c(a,b){var d=a.getContext('2d'),e=Math.min(a.width/b.width,a.height/b.height),f=b.width*e,g=b.height*e,h=a.width/2-f/2,i=a.height/2-g/2;d.drawImage(b,h,i,f,g)},rotate:function d(a,b,c){var e=a.getContext('2d');e.clearRect(0,0,a.width,a.height);e.save();e.translate(a.width/2,a.height/2);e.rotate(Math.PI/180*c);e.drawImage(b,-b.width/2,-b.height/2);e.restore();return a}};export default ImageFileConvert
